# Simulation

Build the machinery to simulate the evolution of traits on trees. Focus for now on DNA evolution.


## Models

Generative models

The intent is a simplified representation of the process under consideration.

"All models are wrong, some are useful"


## A simple model

Let's start with a simple model of DNA evolution. Imagine that when the DNA is being replicated, most of the time the appropriate nucleotide is incorporated. Some fraction of the time, though, a random nucleotide is incorporated. The probability of selecting any of the nucleotides during one of these random events is uniform (picking a C is just as probably as picking a G, for example), and the new nucleotide doesn't depend in any way on what nucleotide was there before. It is as if you had a bag containing equal frequencies of C, G, T, and A nucleotides, and as you replicated the DNA every so often you would reach into the bag with your eyes closed and pick a nucleotide at random rather than the complement of the nucleotide in the strand being replicated.

This model of evolution has a few properties of note. First, given enough evolutionary time, each nucleotide would be just as probable at any site no matter what the starting sequence was. That's because when you reach into the bag, you have the same chance of grabbing any nucleotide. Even if you started with a sequence that had 100 A's, after enough evolutionary time had passed to reach equilibrium you would expect 25 C's, 25 G's, 25 T's, and 25 A's.

Second, not all events will result in an apparent change. Sometimes the previous nucleotide is replaced with the exact same nucleotide. If, for example, the previous nucleotide was an A, under this model $1/4$ of the time an event occurs the previous A is replaced with a new A and there is no apparent change. In such a case, there is not been a substitution (just a replacement in kind). If the A is replaced with any of the other three nucleotides we say there has been a substitution. Because three of the four possible outcomes of an event result in a substitution, the substitution rate is $3\beta$, which, because $\beta=\mu/4$, is equivalent to noting that the substitution is $(3/4) \mu$. Because some events result in no apparent change, substitutions are only a subset of events and the substitution rate is *lower* than the event rate.

There are two things to consider if we want to know the amount of evolutionary change. The first is the substitution rate $\mu$ (or ), and the time that has elapsed. In Figure XX the amount of evolutionary time is held constant, and the rate is changed.


```{r}

  mu_step = 0.001
  mu = seq( 0, 0.01, mu_step )
  
  t = 100  # total time to consider
  n = 1000 # number of steps
  
  
  segments = lapply( mu, function(x){
    sim_jc( mu=x, t, first = "A" ) %>% mutate ( mu=x  )
  }  ) %>%
    bind_rows()
  
  
  segments = sim_jc( mu, t )
  
  ggplot( segments ) +
    scale_x_continuous(name="time") +
    geom_rect( mapping=aes(xmin=start, xmax=end, fill=nucleotide ), ymin=0, ymax=t/20 ) +
    geom_segment( mapping=aes(x=start, xend=start ), y=0, yend=t/20 ) +
    xlim( 0, t) +
    ylim( 0, t)
    
  
  
```






## Generalizing the simple model





rates, equilibrium frequencies

```{r}

e = matrix(c(0.25,0.25,0.25,0.25),nrow=4)

R =matrix(c(
  -3,1,1,1,
  1,-3,1,1,
  1,1,-3,1,
  1,1,1,-3
),
nrow=4
)

Q = R %*% e

Q

```


exponentiation


## More complex models



## Model structure





## Aditional resources

- My own thinking about this material was heavilly influenced by Paul Lewis's wonderful lectures at the annual Workshop on Molecular Evolution at Woods Hole. Some of his lectures are now available online as part of the excellent [Phylo Seminar](https://www.youtube.com/channel/UCbAzhfySv7nLCrNYqZvBSMg), starting with https://www.youtube.com/watch?v=1r4z0YJq580&t=2111s

